The following code seems to be a much faster ECMP simulator than the one originally used in repetita.

Assuming setting is available :


// Supposed faster way
Topology topology = setting.getTopology();
int nEdges = topology.nEdges;
Demands demands = setting.getDemands();

float[][][] edgeLoadPerPair = makeedgeLoadPerPair(topology);

float[] edgeLoads = new float[nEdges];
for (int i = 0; i < demands.nDemands; i++) {
    for (int j = 0; j < nEdges; j++) {
        edgeLoads[j] += edgeLoadPerPair[demands.dest[i]][demands.source[i]][j] * demands.amount[i];
    }
}

// Original long way
ECMPFlowSimulator flowsim = new ECMPFlowSimulator();
flowsim.setup(setting);
flowsim.computeFlows();


Problem of floating point precision e.g.
public class HelloWorld{

     public static void main(String []args){
        float a = 1.0f/3;
        float b = 1.0f/3;
        b = b/3;
        b = b/3;
        b = b+b+b+b+b+b+b+b+b;
        System.out.println(b);
        System.out.println(a==b);
     }
}